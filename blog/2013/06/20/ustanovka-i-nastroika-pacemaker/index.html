
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Установка и настройка кластера Pacemaker - Sibilia octopress blog</title>
  <meta name="author" content="Ilia Sibiryatkin">

  
  <meta name="description" content="Для построения кластеров high availability (высокой доступности) я в своей работе использую Pacemaker. Он себя хорошо зарекомендовал на многих &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://Sibilia.github.com/blog/2013/06/20/ustanovka-i-nastroika-pacemaker/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="Sibilia octopress blog" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Sibilia octopress blog</a></h1>
  
    <h2>notes on memory.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:Sibilia.github.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Установка и настройка кластера Pacemaker</h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-06-20T12:41:00+03:00" pubdate data-updated="true">Jun 20<span>th</span>, 2013</time>
        
         | <a href="#disqus_thread">Comments</a>
        
      </p>
    
  </header>


<div class="entry-content"><p>Для построения кластеров high availability (высокой доступности) я в своей работе использую <a href="http://clusterlabs.org/">Pacemaker</a>. Он себя хорошо зарекомендовал на многих проектах, очень гибкий, динамически развивается. Здесь я приведу краткую инструкцию себе на память по его установке и начальной настройке. Я не претендую на полноту изложения, за этим лучше идти в официальную <a href="http://clusterlabs.org/doc/">документацию</a>, благо она неплохо написана. Используемый дистрибутив CentOS 6. Пример будет описан на двух однотипных серверах.</p>

<!--more-->


<h3>Подготовка</h3>

<p>Описывать установку CentOS я не буду, этого материала хватает. Я рекомендую устанавливать минимальный netinstall, всё что нужно сами доставим.</p>

<p>Вкратце опишу что нам нужно перед тем как приступить непосредственно к установке pacemaker:</p>

<ul>
<li>Установленная CentOS.</li>
<li>Настроенная сеть:  сервера должны быть в одной сети (по крайней мере для этого примера).</li>
<li>hostname прописаны в /etc/hosts (как свой так и соседа). В данном примере будут использоваться имена <strong>node1</strong> и <strong>node2</strong>.</li>
<li>Установлен и настроен SSH. Сгенерированы RSA ключи и разнесены по нодам. Доступ между node1 и node2 по ssh осуществляется без пароля. Есть в принципе способ генерировать ключи непосредственно внутри pacemaker, но этот способ я не рассматриваю, если интересно то вам нужно после установки кластера запустить <em>corosync-keygen</em> и разнести файл /etc/corosync/authkey по нодам.</li>
<li>Установлен и настроен NTP.</li>
</ul>


<p>Устанавливать будем из репозитрия pacemaker - <a href="http://clusterlabs.org/rpm-next/">clusterlabs</a>, там стабильная версия и более свежая по сравнение с репозиторием CentOS. Добавляем репозиторий.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>wget -O /etc/yum.repos.d/pacemaker.repo http://clusterlabs.org/rpm-next/rhel-6/clusterlabs.repo</span></code></pre></td></tr></table></div></figure>


<p>Для работы с pacemaker я использую crm shell. К моему сожалению он теперь поставляется отдельно, добавим репозиторий для его установки. Можно его не ставить, тогда можно работать с pcmk, но мне удобен больше crm shell.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>wget -O /etc/yum.repos.d/ha-clustering.repo http://download.opensuse.org/repositories/network:/ha-clustering/CentOS_CentOS-6/network:ha-clustering.repo</span></code></pre></td></tr></table></div></figure>


<h3>Установка</h3>

<p>Текущая стабильная версия pacemaker использует архитектуру CMAN (вместо openais). Вообще, история развития кластера pacemaker/corosync очень багатая на глобальные изменения, но это отделная тема. Если интересна история развития кластеров то могу порекомендовать вот эту <a href="http://mlug.linux.by/?p=413">презентацию</a> от Владислава Богданова, ему кстати большая благодарность.</p>

<p>Приступим к установке:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># yum install pacemaker cman crmsh ccs</span></code></pre></td></tr></table></div></figure>


<p>После завершения установки, у меня были следующие версии основных пакетов:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># rpm -qa |grep -e pacemaker -e cman -e corosync -e crmsh
</span><span class='line'>pacemaker-cli-1.1.9-1512.el6.x86_64
</span><span class='line'>pacemaker-1.1.9-1512.el6.x86_64
</span><span class='line'>corosync-1.4.5-35.1.x86_64
</span><span class='line'>pacemaker-libs-1.1.9-1512.el6.x86_64
</span><span class='line'>pacemaker-cluster-libs-1.1.9-1512.el6.x86_64
</span><span class='line'>cman-3.0.12.1-49.el6.x86_64
</span><span class='line'>corosynclib-1.4.5-35.1.x86_64
</span><span class='line'>crmsh-1.2.5-55.6.x86_64</span></code></pre></td></tr></table></div></figure>


<p>Копируем пример конфига:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cp /etc/corosync/corosync.conf.example.udpu /etc/corosync/corosync.conf</span></code></pre></td></tr></table></div></figure>


<p>Я использую для связи между нодами клсатера unicast вместо multicast, на сеть нагрузки меньше, защита лучше. Редактируем конфиг для нашей ситауции. Для тонкой настройки рекомендую почитать <em>man corosync.conf</em>. Привожу конфиг /etc/corosync/corosync.conf:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># Please read the corosync.conf.5 manual page
</span><span class='line'>compatibility: whitetank
</span><span class='line'>
</span><span class='line'>totem {
</span><span class='line'>        version: 2
</span><span class='line'>        secauth: off
</span><span class='line'>        threads: 0
</span><span class='line'>        transport: udpu
</span><span class='line'>        interface {
</span><span class='line'>                member {
</span><span class='line'>                        memberaddr: 10.10.0.210
</span><span class='line'>                }
</span><span class='line'>                member {
</span><span class='line'>                        memberaddr: 10.10.0.211
</span><span class='line'>                }
</span><span class='line'>                ringnumber: 0
</span><span class='line'>                bindnetaddr: 10.10.0.0
</span><span class='line'>                mcastaddr: 226.98.1.1
</span><span class='line'>                mcastport: 5500
</span><span class='line'>                ttl: 1
</span><span class='line'>        }
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>logging {
</span><span class='line'>        fileline: off
</span><span class='line'>        to_stderr: no
</span><span class='line'>        to_logfile: yes
</span><span class='line'>        to_syslog: yes
</span><span class='line'>        logfile: /var/log/cluster/corosync.log
</span><span class='line'>        debug: on
</span><span class='line'>        timestamp: on
</span><span class='line'>        logger_subsys {
</span><span class='line'>                subsys: AMF
</span><span class='line'>                debug: off
</span><span class='line'>        }
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>amf {
</span><span class='line'>        mode: disabled
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p>Так же не забываем включить сервис Pacemaker:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># cat &lt;&lt; END &gt;&gt; /etc/corosync/service.d/pcmk
</span><span class='line'>service {
</span><span class='line'>        name: pacemaker
</span><span class='line'>        ver:  1
</span><span class='line'>}
</span><span class='line'>END</span></code></pre></td></tr></table></div></figure>


<p>По поводу значения <em>ver:  1</em>, он указывает что сервис pacemaker мы будем запускать сами. Для начала оставим так, в дальнейшем его можно поменять на <em>ver:  0</em> тогда pacemaker будет запускаться сам после запуска кластера.</p>

<p>Для CMAN необходим ещё один конфигурационный файл /etc/cluster/cluster.conf. Он имеет формат xml. Писать ручками его не практично, будем использовать установленную ранее <em>ccs</em>. Для начала пропишем имя кластеру и добавим ноды:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># ccs -f /etc/cluster/cluster.conf --createcluster my_cluster
</span><span class='line'># ccs -f /etc/cluster/cluster.conf --addnode node1
</span><span class='line'>Node node1 added.
</span><span class='line'># ccs -f /etc/cluster/cluster.conf --addnode node2
</span><span class='line'>Node node2 added.</span></code></pre></td></tr></table></div></figure>


<p>Затем, как написано в документации pacemaker:</p>

<blockquote><p>Далее нам нужно научить CMAN как посылать запросы fencing для pacemaker. Мы прописываем это независимо от того, включен fencing в pacemaker, или нет.</p></blockquote>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># ccs -f /etc/cluster/cluster.conf --addfencedev pcmk agent=fence_pcmk
</span><span class='line'># ccs -f /etc/cluster/cluster.conf --addmethod pcmk-redirect node1
</span><span class='line'>Method pcmk-redirect added to node1.
</span><span class='line'># ccs -f /etc/cluster/cluster.conf --addmethod pcmk-redirect node2
</span><span class='line'>Method pcmk-redirect added to node2.
</span><span class='line'># ccs -f /etc/cluster/cluster.conf --addfenceinst pcmk node1 pcmk-redirect port=node1
</span><span class='line'># ccs -f /etc/cluster/cluster.conf --addfenceinst pcmk node2 pcmk-redirect port=node2</span></code></pre></td></tr></table></div></figure>


<p>После смотрим что у нас получилось, проверяем синтаксис с помощью <em>ccs_config_validate</em> и копируем этот конфиг на вторую ноду.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># cat /etc/cluster/cluster.conf
</span><span class='line'>&lt;cluster config_version="8" name="my_cluster"&gt;
</span><span class='line'>  &lt;fence_daemon/&gt;
</span><span class='line'>  &lt;clusternodes&gt;
</span><span class='line'>    &lt;clusternode name="node1" nodeid="1"&gt;
</span><span class='line'>      &lt;fence&gt;
</span><span class='line'>        &lt;method name="pcmk-redirect"&gt;
</span><span class='line'>          &lt;device name="pcmk" port="node1"/&gt;
</span><span class='line'>        &lt;/method&gt;
</span><span class='line'>      &lt;/fence&gt;
</span><span class='line'>    &lt;/clusternode&gt;
</span><span class='line'>    &lt;clusternode name="node2" nodeid="2"&gt;
</span><span class='line'>      &lt;fence&gt;
</span><span class='line'>        &lt;method name="pcmk-redirect"&gt;
</span><span class='line'>          &lt;device name="pcmk" port="node2"/&gt;
</span><span class='line'>        &lt;/method&gt;
</span><span class='line'>      &lt;/fence&gt;
</span><span class='line'>    &lt;/clusternode&gt;
</span><span class='line'>  &lt;/clusternodes&gt;
</span><span class='line'>  &lt;cman/&gt;
</span><span class='line'>  &lt;fencedevices&gt;
</span><span class='line'>    &lt;fencedevice agent="fence_pcmk" name="pcmk"/&gt;
</span><span class='line'>  &lt;/fencedevices&gt;
</span><span class='line'>  &lt;rm&gt;
</span><span class='line'>    &lt;failoverdomains/&gt;
</span><span class='line'>    &lt;resources/&gt;
</span><span class='line'>  &lt;/rm&gt;
</span><span class='line'>&lt;/cluster&gt;
</span><span class='line'># ccs_config_validate
</span><span class='line'>Configuration validates
</span><span class='line'># scp /etc/cluster/cluster.conf node2:/etc/cluster/cluster.conf</span></code></pre></td></tr></table></div></figure>


<p>Всё отлично. Повторяем все предыдущие шаги на node2. Теперь мы имеем подготовленные node1 и node2.</p>

<p>Теперь можно запускать кластер, но перед этим ещё одно замечание.</p>

<p>Первоначально, CMAN была написана для rgmanager и предполагает, что кластер не должен запускаться, пока нода не имеет кворума. Поэтому прежде чем пытаться запустить кластер, мы отключим эту особеннсть. Выполняем на node1 и node2:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># echo "CMAN_QUORUM_TIMEOUT=0" &gt;&gt; /etc/sysconfig/cman</span></code></pre></td></tr></table></div></figure>


<p>Теперь пробуем запустить кластер. Выполняем на node1 и node2:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># service cman start
</span><span class='line'>Starting cluster: 
</span><span class='line'>   Checking if cluster has been disabled at boot...        [  OK  ]
</span><span class='line'>   Checking Network Manager...                             [  OK  ]
</span><span class='line'>   Global setup...                                         [  OK  ]
</span><span class='line'>   Loading kernel modules...                               [  OK  ]
</span><span class='line'>   Mounting configfs...                                    [  OK  ]
</span><span class='line'>   Starting cman...                                        [  OK  ]
</span><span class='line'>   Waiting for quorum...                                   [  OK  ]
</span><span class='line'>   Starting fenced...                                      [  OK  ]
</span><span class='line'>   Starting dlm_controld...                                [  OK  ]
</span><span class='line'>   Tuning DLM kernel config...                             [  OK  ]
</span><span class='line'>   Starting gfs_controld...                                [  OK  ]
</span><span class='line'>   Unfencing self...                                       [  OK  ]
</span><span class='line'>   Joining fence domain...                                 [  OK  ]</span></code></pre></td></tr></table></div></figure>


<p>Проверяем ноды:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># cman_tool nodes
</span><span class='line'>Node  Sts   Inc   Joined               Name
</span><span class='line'>   1   M     44   2013-06-20 15:20:20  node1
</span><span class='line'>   2   M     40   2013-06-20 15:20:20  node2</span></code></pre></td></tr></table></div></figure>


<p>Вроде всё чисто, проверяем в /var/log/cluster/corosync.log. Ищем там любые warning и error. Если и там всё отлично, пробуем стартовать pacemaker. Опять же запускаем на node1 и node2:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># service pacemaker start
</span><span class='line'>Starting cluster: 
</span><span class='line'>   Checking if cluster has been disabled at boot...        [  OK  ]
</span><span class='line'>   Checking Network Manager...                             [  OK  ]
</span><span class='line'>   Global setup...                                         [  OK  ]
</span><span class='line'>   Loading kernel modules...                               [  OK  ]
</span><span class='line'>   Mounting configfs...                                    [  OK  ]
</span><span class='line'>   Starting cman...                                        [  OK  ]
</span><span class='line'>   Waiting for quorum...                                   [  OK  ]
</span><span class='line'>   Starting fenced...                                      [  OK  ]
</span><span class='line'>   Starting dlm_controld...                                [  OK  ]
</span><span class='line'>   Tuning DLM kernel config...                             [  OK  ]
</span><span class='line'>   Starting gfs_controld...                                [  OK  ]
</span><span class='line'>   Unfencing self...                                       [  OK  ]
</span><span class='line'>   Joining fence domain...                                 [  OK  ]
</span><span class='line'>Starting Pacemaker Cluster Manager:                        [  OK  ]</span></code></pre></td></tr></table></div></figure>


<p>Снова проверяем /var/log/cluster/corosync.log. Там будет несколько warning по поводу отсутствующей конфигурации /var/lib/pacemaker/cib/cib.xml, но это нормально, мы её сейчас будем создавать.</p>

<p>Проверяем состяние кластера:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># crm_mon -1
</span><span class='line'>Stack: cman
</span><span class='line'>Current DC: node1 - partition with quorum
</span><span class='line'>Version: 1.1.9-1512.el6-2a917dd
</span><span class='line'>2 Nodes configured, unknown expected votes
</span><span class='line'>0 Resources configured.
</span><span class='line'>
</span><span class='line'>Online: [ node1 node2 ]</span></code></pre></td></tr></table></div></figure>


<p>Установка закончена. Теперь можно приступать к конфигурированию кластера.</p>

<h3>Конфигурирование pacemaker</h3>

<p>Для управлением конфигурацией кластера будем использовать, как уже раньше отмечалось, crm shell. За разъяснением как работать с pcmk обращайтесь в официальную документацию.</p>

<p>Для начала посмотрим что имеем:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># crm configure show
</span><span class='line'>node node1
</span><span class='line'>node node2
</span><span class='line'>property $id="cib-bootstrap-options" \
</span><span class='line'>        dc-version="1.1.9-1512.el6-2a917dd" \
</span><span class='line'>        cluster-infrastructure="cman"</span></code></pre></td></tr></table></div></figure>


<p>Пропишем основные параметры:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@node2 ~]  # crm
</span><span class='line'>crm(live)# configure 
</span><span class='line'>crm(live)configure# cib new new_conf
</span><span class='line'>INFO: new_conf shadow CIB created
</span><span class='line'>crm(new_conf)configure# cib use new_conf 
</span><span class='line'>crm(new_conf)configure# property stonith-enabled=false
</span><span class='line'>crm(new_conf)configure# property no-quorum-policy=ignore
</span><span class='line'>crm(new_conf)configure# property pe-error-series-max=128
</span><span class='line'>crm(new_conf)configure# property pe-input-series-max=128
</span><span class='line'>crm(new_conf)configure# property pe-warn-series-max=128
</span><span class='line'>crm(new_conf)configure# property symmetric-cluster=false
</span><span class='line'>crm(new_conf)configure# commit 
</span><span class='line'>crm(new_conf)configure# cib use live
</span><span class='line'>crm(live)configure# cib commit new_conf
</span><span class='line'>crm(live)configure# show 
</span><span class='line'>node node1
</span><span class='line'>node node2
</span><span class='line'>property $id="cib-bootstrap-options" \
</span><span class='line'>        dc-version="1.1.9-1512.el6-2a917dd" \
</span><span class='line'>        cluster-infrastructure="cman" \
</span><span class='line'>        stonith-enabled="false" \
</span><span class='line'>        no-quorum-policy="ignore" \
</span><span class='line'>        pe-error-series-max="128" \
</span><span class='line'>        pe-input-series-max="128" \
</span><span class='line'>        pe-warn-series-max="128" \
</span><span class='line'>        symmetric-cluster="false"</span></code></pre></td></tr></table></div></figure>


<p>Так, теперь немного комментариев:</p>

<ul>
<li><p><em>crm(live)configure# cib new new_conf</em> - Создаём новую конфигурацию в CIB, в которой и будем делать все изменения. Не рекомендую работать в основной cib (live). Все изменения в новой конфигурации (new_conf) не применяются на кластер до тех пор пока мы её не перенесём в cib live с помощью <em>cib commit new_conf</em>.</p></li>
<li><p><em>property stonith-enabled=false</em> и <em>property no-quorum-policy=ignore</em> - Выключаем fencing и действия по умолчанию при потере кворума.</p></li>
<li><p><em>property symmetric-cluster=false</em> - Переводим кластер в несимметричный режим. В отличии от симметричного, он не запускает нигде никакие ресурсы, если это явно не разрешено в location (об этом ниже). В принципе, в данном случае это нам не нужно, даже добавляет неудобства. Однако это добавляет удобства в конфигурировании если нод больше двух и много ресурсов, которые привязаны только к определённым из них. Я не настаиваю на этом параметре, необходимость в нём зависит от архитектуры кластера.</p></li>
</ul>


<h3>Ресурсы кластера</h3>

<p>Ресурсами в кластере могут являться программы, скрипты, ip адреса, файловые системы и т.д. Вариаций много. Скрипты для управления ресурсами находятся в /usr/lib/ocf/resource.d/. К примеру вот список доступных ресурс агентов для провайдера Heartbeat:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># crm ra list ocf heartbeat
</span><span class='line'>AoEtarget           AudibleAlarm        CTDB                ClusterMon
</span><span class='line'>Delay               Dummy               EvmsSCC             Evmsd
</span><span class='line'>Filesystem          ICP                 IPaddr              IPaddr2
</span><span class='line'>IPsrcaddr           IPv6addr            LVM                 LinuxSCSI
</span><span class='line'>MailTo              ManageRAID          ManageVE            Pure-FTPd
</span><span class='line'>Raid1               Route               SAPDatabase         SAPInstance
</span><span class='line'>SendArp             ServeRAID           SphinxSearchDaemon  Squid
</span><span class='line'>Stateful            SysInfo             VIPArip             VirtualDomain
</span><span class='line'>WAS                 WAS6                WinPopup            Xen
</span><span class='line'>Xinetd              anything            apache              conntrackd
</span><span class='line'>db2                 drbd                eDir88              ethmonitor
</span><span class='line'>exportfs            fio                 iSCSILogicalUnit    iSCSITarget
</span><span class='line'>ids                 iscsi               jboss               lsyncd
</span><span class='line'>lxc                 mysql               mysql-proxy         nfsserver
</span><span class='line'>nginx               oracle              oralsnr             pgsql
</span><span class='line'>pingd               portblock           postfix             proftpd
</span><span class='line'>rsyncd              scsi2reservation    sfex                symlink
</span><span class='line'>syslog-ng           tomcat              vmware</span></code></pre></td></tr></table></div></figure>


<p>Если нет нужного, можно написать свой. Написаны ресурс агенты на bash.­</p>

<p>Приступим к добавлению ресурсов. Создадим к примеру следующую конфигурацию:</p>

<p>Имеется две ноды, на них установлен и настроен nginx, для синхронизации рабочей директории nginx будет использоваться lsyncd/unison. Балансировка будет присходить по двум плавающим ip адресам.</p>

<p>Для начала устанавливаем всё необходимое:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>yum install nginx lsyncd unison</span></code></pre></td></tr></table></div></figure>


<p>Про настройку lsyncd я уже <a href="http://sibilia.github.io/blog/2013/03/26/sinkhronizatsiia-failov-s-pomoshchiu-lsyncd-i-unison/">писал</a>. Просто меняем в <em>source</em> и в команде запуска unison /mnt/lsynced на что-нибудь вроде /usr/share/nginx/html. Это конечно зависит от nginx.</p>

<p>Проверяем lsyncd. Запускаем на node2 и создаём файлик на ней же /usr/share/nginx/html/test. В выводе будет что-то вроде:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@node2 ~]  # lsyncd -nodaemon /etc/lsyncd.conf
</span><span class='line'>16:37:59 Normal: Event Create spawns action "/usr/bin/unison -retry 5 -owner -group -batch /usr/share/nginx/html ssh://node1//usr/share/nginx/html"
</span><span class='line'>Contacting server...
</span><span class='line'>Connected [//node1//usr/share/nginx/html -&gt; //node2//usr/share/nginx/html]
</span><span class='line'>...
</span><span class='line'>Synchronization complete  (1 item transferred, 0 skipped, 0 failures)
</span><span class='line'>16:37:59 Normal: Retrying Create on /usr/share/nginx/html//test = 0</span></code></pre></td></tr></table></div></figure>


<p>Всё отлично, прерываем lsyncd по ctrl-c.
Ресурс агент для lsyncd я буду использовать свой. Для этого добавляем его на node1 и node2:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>wget -O /usr/lib/ocf/resource.d/heartbeat/lsyncd https://raw.github.com/Sibilia/scripts/master/lsyncd</span></code></pre></td></tr></table></div></figure>


<p>Настройку nginx приводить не буду, подключайте фантазию.</p>

<p>Теперь приступим к созданию ресурсов в кластере. Для lsyncd я буду использовать clone ресурс, а для nginx два разных ресурса для каждой ноды просто для примера. Выбор того или иного способа описания ресурсов зависит лишь от ситуации и ваших личных предпочтений.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># crm
</span><span class='line'>crm(live)# configure 
</span><span class='line'>crm(live)configure# cib use new_conf
</span><span class='line'>crm(new_conf)configure# edit</span></code></pre></td></tr></table></div></figure>


<p>И приводим конфигурацию к следующему виуу:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>node node1
</span><span class='line'>node node2
</span><span class='line'>primitive ipaddr_215 ocf:heartbeat:IPaddr2 \
</span><span class='line'>        params ip="10.10.0.215"
</span><span class='line'>primitive ipaddr_216 ocf:heartbeat:IPaddr2 \
</span><span class='line'>        params ip="10.10.0.216"
</span><span class='line'>primitive lsyncd ocf:heartbeat:lsyncd \
</span><span class='line'>        params cmdline_options="-log scarce"
</span><span class='line'>primitive nginx1 ocf:heartbeat:nginx
</span><span class='line'>primitive nginx2 ocf:heartbeat:nginx
</span><span class='line'>clone lsyncd-cl lsyncd
</span><span class='line'>location ip_215-on-node1 ipaddr_215 1000: node1
</span><span class='line'>location ip_215-on-node2 ipaddr_215 500: node2
</span><span class='line'>location ip_216-on-node1 ipaddr_216 500: node1
</span><span class='line'>location ip_216-on-node2 ipaddr_216 1000: node2
</span><span class='line'>location lsyncd-on-node1 lsyncd-cl 500: node1
</span><span class='line'>location lsyncd-on-node2 lsyncd-cl 500: node2
</span><span class='line'>location nginx1-on-node1 nginx1 inf: node1
</span><span class='line'>location nginx2-on-node2 nginx2 inf: node2
</span><span class='line'>property $id="cib-bootstrap-options" \
</span><span class='line'>        dc-version="1.1.9-1512.el6-2a917dd" \
</span><span class='line'>        cluster-infrastructure="cman" \
</span><span class='line'>        stonith-enabled="false" \
</span><span class='line'>        no-quorum-policy="ignore" \
</span><span class='line'>        pe-error-series-max="128" \
</span><span class='line'>        pe-input-series-max="128" \
</span><span class='line'>        pe-warn-series-max="128" \
</span><span class='line'>        symmetric-cluster="false"</span></code></pre></td></tr></table></div></figure>


<p>После выходим из редактора и применяем конфигурацию на кластер:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>crm(new_conf)configure# commit
</span><span class='line'>crm(new_conf)configure# cib use
</span><span class='line'>crm(live)configure# cib commit new_conf 
</span><span class='line'>INFO: commited 'new_conf' shadow CIB to the cluster
</span><span class='line'>crm(live)configure# show</span></code></pre></td></tr></table></div></figure>


<p>Теперь проверяем как всё запустилось:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># crm_mon -fnr1
</span><span class='line'>Stack: cman
</span><span class='line'>Current DC: node2 - partition with quorum
</span><span class='line'>Version: 1.1.9-1512.el6-2a917dd
</span><span class='line'>2 Nodes configured, unknown expected votes
</span><span class='line'>6 Resources configured.
</span><span class='line'>
</span><span class='line'>Node node1: online
</span><span class='line'>        nginx1  (ocf::heartbeat:nginx): Started 
</span><span class='line'>        ipaddr_215      (ocf::heartbeat:IPaddr2):       Started 
</span><span class='line'>        lsyncd:1        (ocf::heartbeat:lsyncd):        Started 
</span><span class='line'>Node node2: online
</span><span class='line'>        nginx2  (ocf::heartbeat:nginx): Started 
</span><span class='line'>        lsyncd:0        (ocf::heartbeat:lsyncd):        Started 
</span><span class='line'>        ipaddr_216      (ocf::heartbeat:IPaddr2):       Started 
</span><span class='line'>
</span><span class='line'>Inactive resources:
</span><span class='line'>
</span><span class='line'>Migration summary:
</span><span class='line'>* Node node2: 
</span><span class='line'>* Node node1: </span></code></pre></td></tr></table></div></figure>


<p>Проверим случай выпадения одной ноды, после её вернём обратно:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># crm node standby node1
</span><span class='line'># crm_mon -fnr1
</span><span class='line'>Stack: cman
</span><span class='line'>Current DC: node2 - partition with quorum
</span><span class='line'>Version: 1.1.9-1512.el6-2a917dd
</span><span class='line'>2 Nodes configured, unknown expected votes
</span><span class='line'>6 Resources configured.
</span><span class='line'>
</span><span class='line'>Node node1: standby
</span><span class='line'>Node node2: online
</span><span class='line'>        nginx2  (ocf::heartbeat:nginx): Started 
</span><span class='line'>        ipaddr_215      (ocf::heartbeat:IPaddr2):       Started 
</span><span class='line'>        lsyncd:0        (ocf::heartbeat:lsyncd):        Started 
</span><span class='line'>        ipaddr_216      (ocf::heartbeat:IPaddr2):       Started 
</span><span class='line'>
</span><span class='line'>Inactive resources:
</span><span class='line'>
</span><span class='line'> nginx1 (ocf::heartbeat:nginx): Stopped 
</span><span class='line'> Clone Set: lsyncd-cl [lsyncd]
</span><span class='line'>     Started: [ node2 ]
</span><span class='line'>     Stopped: [ lsyncd:1 ]
</span><span class='line'>
</span><span class='line'>Migration summary:
</span><span class='line'>* Node node2: 
</span><span class='line'>* Node node1:
</span><span class='line'>
</span><span class='line'># crm node online node1</span></code></pre></td></tr></table></div></figure>


<p>Убедились что оба ip адреса переплыли на одну ноду.</p>

<h3>Работа с кластером</h3>

<p>В рабочем процессе, мы можем управлять состояниями нод и состоянием/размещением ресурсов.
К примеру выведем ноду из кластера и вернём обратно:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># crm node standby node1
</span><span class='line'># crm node online node1</span></code></pre></td></tr></table></div></figure>


<p>Можем остановить/переместить ресурс:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># crm resource move ipaddr_216 node1
</span><span class='line'># crm resource stop ipaddr_216
</span><span class='line'># crm resource start ipaddr_216
</span><span class='line'># crm resource unmove ipaddr_216</span></code></pre></td></tr></table></div></figure>


<p>Все эти действия сразу выполняются. Бывает ситуация, когда ресурс вылетает, тогда pacemaker определяет по мониторингу что он не запущен и сново запускает, увеличевая при этом счётчик таких ошибок. К примеру убъём процесс nginx:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># ps aux |grep nginx |grep -v grep
</span><span class='line'>root     10796  0.0  0.4  96024  2040 ?        Ss   18:48   0:00 nginx: master process /usr/sbin/nginx -c /etc/nginx/nginx.conf
</span><span class='line'>nginx    10798  0.0  0.5  96376  2708 ?        S    18:48   0:00 nginx: worker process                   
</span><span class='line'># kill -KILL 10796 10798
</span><span class='line'># crm_mon -fnr1
</span><span class='line'>...
</span><span class='line'>Node node1: online
</span><span class='line'>        nginx1  (ocf::heartbeat:nginx): Started 
</span><span class='line'>        ipaddr_215      (ocf::heartbeat:IPaddr2):       Started 
</span><span class='line'>        lsyncd:1        (ocf::heartbeat:lsyncd):        Started 
</span><span class='line'>Node node2: online
</span><span class='line'>        nginx2  (ocf::heartbeat:nginx): Started 
</span><span class='line'>        ipaddr_216      (ocf::heartbeat:IPaddr2):       Started 
</span><span class='line'>        lsyncd:0        (ocf::heartbeat:lsyncd):        Started 
</span><span class='line'>
</span><span class='line'>Inactive resources:
</span><span class='line'>
</span><span class='line'>Migration summary:
</span><span class='line'>* Node node2: 
</span><span class='line'>* Node node1: 
</span><span class='line'>   nginx1: migration-threshold=1000000 fail-count=2 last-failure='Thu Jun 20 19:17:19 2013'
</span><span class='line'>
</span><span class='line'>Failed actions:
</span><span class='line'>    nginx1_monitor_5000 (node=node1, call=276, rc=7, status=complete): not running</span></code></pre></td></tr></table></div></figure>


<p>Появилась запись что были ошибки. Если же ресурс не может запуститься, или слишком часто вылетает, то значение счётчика fail-count выставляется в 1000000 и после этого этот ресурс на этой ноде не будет восстонавливаться. А для сброса счётчика можно сделать:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># crm resource cleanup nginx1</span></code></pre></td></tr></table></div></figure>


<h3>P.S.</h3>

<p>Это лишь самые базовые возможности Pacemaker. Есть ещё очерёдность запуска (order), совместное размещение (colocation), группы и т.д. Если есть какие замечания, пожелания, неточности в статье, оставляйте в комментариях или дишите на почту.</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Ilia Sibiryatkin</span></span>

      








  


<time datetime="2013-06-20T12:41:00+03:00" pubdate data-updated="true">Jun 20<span>th</span>, 2013</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/cluster/'>cluster</a>, <a class='category' href='/blog/categories/linux/'>linux</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://Sibilia.github.com/blog/2013/06/20/ustanovka-i-nastroika-pacemaker/" data-via="" data-counturl="http://Sibilia.github.com/blog/2013/06/20/ustanovka-i-nastroika-pacemaker/" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium"></div>
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2013/05/28/ssh-trick/" title="Previous Post: SSH трюки">&laquo; SSH трюки</a>
      
      
        <a class="basic-alignment right" href="/blog/2013/07/10/rieplikatsiia-diskov-po-sieti-s-pomoshchiu-drbd/" title="Next Post: Репликация дисков по сети с помощью DRBD">Репликация дисков по сети с помощью DRBD &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2013/07/10/rieplikatsiia-diskov-po-sieti-s-pomoshchiu-drbd/">Репликация дисков по сети с помощью DRBD</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/06/20/ustanovka-i-nastroika-pacemaker/">Установка и настройка кластера Pacemaker</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/05/28/ssh-trick/">SSH трюки</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/04/11/ntp-sinkhronizatsiia-vriemieni/">NTP - синхронизация времени</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/03/26/sinkhronizatsiia-failov-s-pomoshchiu-lsyncd-i-unison/">Синхронизация файлов с помощью Lsyncd и Unison</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/Sibilia">@Sibilia</a> on GitHub
  
  <script type="text/javascript">
    $.domReady(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'Sibilia',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>




<section class="googleplus">
  <h1>
    <a href="https://plus.google.com/112831317637790292721?rel=author">
      <img src="http://www.google.com/images/icons/ui/gprofile_button-32.png" width="32" height="32">
      Google+
    </a>
  </h1>
</section>



  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013 - Ilia Sibiryatkin -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'sibilia-octopress';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://Sibilia.github.com/blog/2013/06/20/ustanovka-i-nastroika-pacemaker/';
        var disqus_url = 'http://Sibilia.github.com/blog/2013/06/20/ustanovka-i-nastroika-pacemaker/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>





  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
